# Caddyfile for Bisect Bot
# Auto-generated by Ansible - do not edit manually

{
    email {{ vault_admin_email | default('admin@example.com') }}
}

{{ vault_domain }} {
    # Web app routes
    handle /dashboard* {
        reverse_proxy web:8000
    }

    handle /auth* {
        reverse_proxy web:8000
    }

    handle /api* {
        reverse_proxy web:8000
    }

    # Bot routes
    handle /webhook {
        reverse_proxy bot:8000
    }

    handle /health {
        reverse_proxy bot:8000
    }

    handle /queue/* {
        reverse_proxy bot:8000
    }

    handle /job/* {
        reverse_proxy bot:8000
    }

    # Default to web app (landing page)
    handle {
        reverse_proxy web:8000
    }

    # Security headers
    header {
        X-Content-Type-Options nosniff
        X-Frame-Options DENY
        Referrer-Policy strict-origin-when-cross-origin
        X-XSS-Protection "1; mode=block"
        -Server
    }

    # Enable compression
    encode gzip

    # Logging
    log {
        output file /var/log/caddy/access.log {
            roll_size 100mb
            roll_keep 5
        }
    }
}





